---
import { getCollection } from "astro:content";
import { Image } from "astro:assets"; // <--- Add this import
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { SITE, HOME, SOCIALS } from "@consts";

const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const photography = (await getCollection("photography"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PHOTO_ALBUMS_ON_HOMEPAGE); 
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    
    <h4 class="animate font-semibold text-black dark:text-white">
      Hi, I'm Nicholas Drömert <span class="text-xl"></span> 
    </h4>
    <div class="space-y-16">
      <section>
        <article class="space-y-4">
          <p class="animate">
            Comparative Law Specialist & Web Developer based in Berlin.
          </p>
          <p class="animate">
            I have been very fortunate to benefit from a broad education in several different legal systems through my studies at The University of Birmingham, Humboldt Universität Berlin, and Tongji University Shanghai.
            Legal concepts love to travel around the world, but their implementation often tells you a great deal about local culture and history.
            These stories and insights into different histories and cultures is why I find Comparative so rewarding.
            I continue, when I have time, to write a few short articles on subjects I find particularly interesting which you can find in my blog.
            Other interests of mine include photography - which I have sadly neglected recently - and the violin - which I am happy to say I get to play a great deal at the moment.
          </p>
        </article>
      </section>

      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Latest posts
          </h5>
          <Link href="/blog">
            See all posts
          </Link>
        </div>
        <ul class="flex flex-col gap-4">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h5 class="font-semibold text-black dark:text-white">
            Recent Photography
          </h5>
          <Link href="/photography">
            See all photos
          </Link>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          {photography.map(album => (
            /* FIXED LINK: Now points to the anchor on the main page */
            <a href="/photography" class="group relative block overflow-hidden rounded-lg bg-neutral-100 dark:bg-neutral-900 aspect-[4/3]">
              <Image 
                src={album.data.cover} 
                alt={album.data.title}
                width={720}  
                height={480}
                class="object-cover w-full h-full transition-transform duration-500 group-hover:scale-105 opacity-90 group-hover:opacity-100"
              />
            </a>
          ))}
        </div>
      </section>

      <section class="animate space-y-4">
        <h5 class="font-semibold text-black dark:text-white">
          Let's Connect
        </h5>
        <ul class="flex flex-wrap gap-2">
          {SOCIALS.map(SOCIAL => (
            <li class="flex gap-x-2 text-nowrap">
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME}
              </Link>
              {"/"}
            </li>
          ))}
          <li class="line-clamp-1">
             <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
              {SITE.EMAIL}
            </Link>
          </li>
        </ul>
      </section>

    </div>
  </Container>
</PageLayout>